<section class="page" *ngIf="symbol$ | async as sym">
  <div class="head">
    <div class="title-group">
      <a class="btn-back" routerLink="/dashboard">←</a>
      <h1>{{ sym }}</h1>
      <span class="tag" *ngIf="type$ | async as type" [class.crypto]="type === 'CRYPTO'">{{ type }}</span>
    </div>

    <div class="live-price" *ngIf="liveQuote$ | async as q">
      <span class="val">{{ q.price | number:'1.2-5' }} $</span>
      <span class="pct" [class.pos]="q.changePct >= 0" [class.neg]="q.changePct < 0">
        {{ q.changePct > 0 ? '+' : ''}}{{ q.changePct | number:'1.2-2' }}%
      </span>
    </div>
  </div>

  <div class="grid-layout">
    <div class="main-col">
      <div class="card chart-card">
        <div class="chart-toolbar">
        <div class="res-group">
          <button *ngFor="let r of resolutions" class="res-btn" 
            [class.active]="(resolution$ | async) === r.val"
            (click)="setResolution(r.val)">
            {{ r.label }}
          </button>
        </div>

        <div class="indicators-group">
          <button class="ind-btn" [class.active]="showVolume" (click)="toggleVolume()" title="Volume">
            VOL
          </button>
          <button class="ind-btn" [class.active]="showSMA" (click)="toggleSMA()" title="Simple Moving Average (20)">
            SMA
          </button>
          <button class="ind-btn" [class.active]="showEMA" (click)="toggleEMA()" title="Exponential Moving Average (50)">
            EMA
          </button>
          <button class="ind-btn" [class.active]="showBB" (click)="toggleBB()" title="Bollinger Bands">
            BB
          </button>
        </div>

        <div class="chart-status">
          <span class="dot"></span> Live
        </div>
      </div>
        <div class="chart-container" #chartContainer></div>
      </div>

      <div class="card info-card" *ngIf="profile$ | async as p">
        <h2>{{ p.name }}</h2>
        <div class="badges">
          <span class="badge">{{ p.exchange }}</span>
          <span class="badge">{{ p.sector }}</span>
        </div>
        <p class="desc">{{ p.description }}</p>
      </div>
    </div>

    <div class="side-col">
      <div class="card news-card">
        <h2>Actualités</h2>
        <div class="news-list" *ngIf="news$ | async as newsList; else loadingNews">
          <a *ngFor="let n of newsList" [href]="n.url" target="_blank" class="news-item">
            <div class="news-img" *ngIf="n.image" [style.background-image]="'url(' + n.image + ')'"></div>
            <div class="news-content">
              <div class="news-meta">{{ n.publishedDate | date:'dd MMM' }} • {{ n.source }}</div>
              <div class="news-title">{{ n.title }}</div>
            </div>
          </a>
          <div *ngIf="newsList.length === 0" class="muted">Aucune news trouvée.</div>
        </div>
        <ng-template #loadingNews><div class="muted loader">Recherche des infos...</div></ng-template>
      </div>
    </div>
  </div>
</section>