<section class="page" *ngIf="symbol$ | async as sym">
  <div class="head">
    <div>
      <h1>
        <span class="pill">{{ sym }}</span>
        <span class="muted"> — details</span>
      </h1>

      <div class="muted" *ngIf="profile$ | async as p">
        <span *ngIf="p?.name"><strong>{{ p.name }}</strong></span>
        <span *ngIf="p?.exchange"> • {{ p.exchange }}</span>
        <span *ngIf="p?.finnhubIndustry"> • {{ p.finnhubIndustry }}</span>
      </div>
    </div>

    <div class="actions">
      <a class="btn ghost" routerLink="/dashboard">← Dashboard</a>

      <ng-container *ngIf="inWatchlist$ | async as inWl">
        <button class="btn" *ngIf="!inWl" type="button" (click)="addToWatchlist(sym)">+ Watchlist</button>
        <button class="btn danger" *ngIf="inWl" type="button" (click)="removeFromWatchlist(sym)">Remove</button>
      </ng-container>
    </div>
  </div>

  <div class="card warn" *ngIf="(hasToken$ | async) === false">
    <strong>Clé API manquante.</strong>
    <div class="muted">
      Va dans <a routerLink="/settings">Settings</a> pour coller ton token Finnhub.
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Quote (live)</h2>

      <div class="quote" *ngIf="quote$ | async as q; else noQuote">
        <div class="price">{{ q.c | number:'1.2-2' }}</div>

        <div class="quote" *ngIf="quote$ | async as q; else noQuote">
  <div class="price">
    {{ isFiniteNumber(q.c) ? (q.c | number:'1.2-2') : '—' }}
  </div>

  <div class="chg"
       [class.pos]="isFiniteNumber(q.dp) && q.dp >= 0"
       [class.neg]="isFiniteNumber(q.dp) && q.dp < 0">
    {{ isFiniteNumber(q.dp) && q.dp >= 0 ? '+' : '' }}{{ isFiniteNumber(q.dp) ? (q.dp | number:'1.2-2') : '—' }}%
    <span class="muted"> ({{ isFiniteNumber(q.d) ? (q.d | number:'1.2-2') : '—' }})</span>
  </div>
</div>


        <div class="muted mini">O {{ q.o }} • H {{ q.h }} • L {{ q.l }} • Prev {{ q.pc }}</div>
      </div>

      <ng-template #noQuote>
        <div class="muted">Pas de quote (token manquant ou symbole invalide).</div>
      </ng-template>
    </div>

    <div class="card">
      <div class="row">
        <h2>Chart</h2>

        <div class="controls">
          <label>
            <span class="lbl">Resolution</span>
            <select class="inp" [formControl]="resolutionCtrl">
              <option value="5">5m</option>
              <option value="15">15m</option>
              <option value="30">30m</option>
              <option value="60">1h</option>
              <option value="D">1D</option>
            </select>
          </label>

          <label>
            <span class="lbl">Days</span>
            <input class="inp" type="number" [formControl]="daysCtrl" />
          </label>
        </div>
      </div>

      <div class="chart" *ngIf="chartVm$ | async as vm">
        <svg viewBox="0 0 640 160" preserveAspectRatio="none">
          <polyline *ngIf="vm.points" [attr.points]="vm.points" fill="none" stroke="currentColor" stroke-width="2" />
        </svg>

        <div class="muted mini">
          points: {{ vm.n }} • min: {{ vm.min | number:'1.2-2' }} • max: {{ vm.max | number:'1.2-2' }}
        </div>

        <div class="muted" *ngIf="!vm.points">Pas de données (no_data) ou trop peu de points.</div>
      </div>
    </div>

    <div class="card wide">
      <h2>News</h2>

      <div class="muted" *ngIf="(news$ | async)?.length === 0">Pas de news.</div>

      <div class="news" *ngIf="news$ | async as items">
        <a class="news-item" *ngFor="let it of items" [href]="it.url" target="_blank" rel="noopener">
          <div class="ttl">{{ it.headline }}</div>
          <div class="meta">
            <span class="pill2">{{ it.source }}</span>
            <span class="muted">{{ (it.datetime * 1000) | date:'medium' }}</span>
          </div>
          <div class="muted sum">{{ it.summary }}</div>
        </a>
      </div>
    </div>
  </div>
</section>
